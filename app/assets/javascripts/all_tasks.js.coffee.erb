root = exports ? this

do carousel = -> 
	$(document).ready(()->
		$('#mycarousel').jcarousel()	
		$('div.jcarousel-prev').text("❰")	
		$('div.jcarousel-next').text("❱") 
	)	

do completed_tasks = ->
	$(document).ready(()->
		$.ajax({
			type: "GET",
			url: "http://localhost:3000/todo/completed_tasks/"})
	)

	
do tooltips = ->
	$(document).ready(()->		 
		console.log a = $("span#locales").data('special')
		console.log jQuery.parseJSON(a)
		$('.jcarousel-next, .jcarousel-prev, .add_me, #new_priority, #complete_for_checkbox, #delete_for_checkbox, #reopen_for_checkbox, th#delete, th#edit').attr('rel','tooltip')
			
		$('div.jcarousel-prev').attr('title', $('span#active_tasks').data('locales')) if $('div.jcarousel-prev').is(':disabled') is true
		$('div.jcarousel-next').attr('title', $('span#completed_tasks').data('locales')) if $('div.jcarousel-next').is(':disabled') is false
		$('.add_me').attr('title', $('span#add_new_task').data('locales'))
		$('#new_priority').attr('title', $('span#select_priority').data('locales'))
		$('div#complete_for_checkbox').attr('title', $('span#complete_marked_items').data('locales'))
		$('div#delete_for_checkbox').attr('title', $('span#delete_marked_items').data('locales'))
		$('div#reopen_for_checkbox').attr('title', $('span#reopen_marked_items').data('locales'))
		$('th#delete').attr('title', $('span#delete').data('locales'))
		console.log $('span#delete').data('locales')
		$('th#edit').attr('title', $('span#edit').data('locales'))
	)	

do arrows_onclick = ->
	$(document).ready(()->
		$('.jcarousel-next, .jcarousel-prev').click(()-> 
			$("input[type='checkbox']:checked").prop('checked', false)
			$("input[type='checkbox'], div.checkbox_button, div#validation").hide()
			window.completed_dates = new Array
			$('div#completed_tasks_container').find("td#completed_at div").each(()-> td_text = $(this).text(); completed_dates.push(td_text))
		)
	)

do read_dates = ->
	$(document).ready(()->
		window.active_dates = new Array
		$('div#tasks_container').find("td#created_at div").each(()-> td_text = $(this).text(); active_dates.push(td_text))
	)	

			
@show_actions = show_actions = (task_id)->
	$('.' + task_id + '_action' + ', .pipe' + task_id).show()
	
@hide_actions = hide_actions = (task_id)->
	$('.' + task_id + '_action' + ', .pipe' + task_id).hide()


@bold = bold = (obj)->
	$(obj).find('.items').css('font-weight', 'bold')

@unbold = unbold = (obj)->
	$(obj).find('.items').css('font-weight', 'lighter')


@show_header = show_header = (header_id)->
	$(header_id).removeAttr('hidden')

@hide_header = hide_header = (header_id)->
	$(header_id).attr('hidden', 'true')


@show_boxes = show_boxes = (task_id)->
	$("input[type='checkbox']").show()

@hide_boxes = hide_boxes = (task_id)->
	box = "input[type='checkbox']"	
	if $("#{box}:checked").length > 0 then $(box).show() else $('div.checkbox_button,' + box).hide()

@delete_items= delete_items = (obj)->
	collection = new Array
	path_injection = if $(obj).hasClass('true') then '/completed_tasks/' else '/'

	$("input:checked").each(()-> item_id = $(this).attr('id'); collection.push(item_id))	 
			
	$.ajax({
  		type: "POST",
  		url: "http://localhost:3000/todo#{path_injection}mass_destroy",
  		data: { id: collection }
		})

@complete_items = complete_items = ()->
	collection = new Array

	$("input:checked").each(()-> item_id = $(this).attr('id'); collection.push(item_id))	 
	
	$.ajax({
  		type: "POST",
  		url: "http://localhost:3000/todo/mass_complete",
  		data: { id: collection }
		})

@reopen_items = reopen_items = ()->
	collection = new Array
	
	$("input:checked").each(()-> item_id = $(this).attr('id'); collection.push(item_id))	 
	
	$.ajax({
	  	type: "POST",
	  	url: "http://localhost:3000/todo/completed_tasks/mass_reopen",
	  	data: { id: collection }
  	})


@sort_table_by = sort_table_by = (obj, flag)->
	$('.headers_container').each(()-> $(this).css('font-weight', 'lighter')
								.css('color', '#848484')
								.find('span').remove()							
	)

	if $(obj).hasClass('arrow_down')
		$(obj).append("<span class='filtered'> ⌃</span>")
		$(obj).css('font-weight', 'bold')
				.css('color', 'rgba( 34, 2, 0, 0.8)')
				.removeClass('arrow_down')

		sort_tr(obj, flag, 'asc')				
	else
		$(obj).append("<span class='unfiltered'> ⌵</span>")
		$(obj).css('font-weight', 'bold')
				.css('color', 'rgba(34, 2, 0, 0.8)')
				.addClass('arrow_down')

		
		sort_tr(obj, flag, 'desc')  	
	  		  
@sort_tr = sort_tr = (obj, flag, order)->
	collection = new Array
	subject = $(obj).attr('id')
	container = if flag is 'completed' then 'div#completed_tasks_container' else 'div#tasks_container'

	collection = if subject is 'description' 
		$(container).find("td##{subject} div").each(()-> td_text = $(this).text(); collection.push(td_text))
		collection.sort()		
	else if subject is 'priority' 	
		['high', 'medium', 'low']
	else if subject is 'status'
		['in progress','open']	
	else if subject is 'created_at'
		active_dates
	else if subject is 'completed_at'
		completed_dates	
	
	if order is 'asc'		
			$(container).find("td:contains('#{value}')").parent().appendTo("#{container} tbody") for value in collection
	else if order is 'desc'
			$(container).find("td:contains('#{value}')").parent().prependTo("#{container} tbody") for value in collection